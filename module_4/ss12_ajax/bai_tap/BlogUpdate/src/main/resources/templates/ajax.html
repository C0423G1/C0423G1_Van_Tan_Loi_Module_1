<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vn">
<head>
    <meta charset="UTF-8">
    <title>Product List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>
<body>
<h1>Blog List</h1>
<a th:href="@{/blog/create}">
    <button type="button" class="btn btn-outline-primary">Create</button>
</a>
<form id="searchForm">
    <input type="text" id="name" placeholder="Tên sản phẩm"/>
    <button type="submit">Search</button>
</form>
<div id="result"></div>
<div th:each="category : ${category}">
    <a th:href="@{/blog/category/{id}(id=${category.id})}">
        <button th:text="${category.name}" type="button" class="btn btn-outline-danger"></button>
    </a>
</div>
<table class="table">
    <thead>
    <tr>
        <th>IDD</th>
        <th>Title</th>
        <th>Date</th>
        <th>Delete</th>
        <th>Update</th>
        <th>View</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="blogs : ${blogs}">
        <td th:text="${blogs.id}"></td>
        <td th:text="${blogs.title}"></td>
        <td th:text="${blogs.date}"></td>
        <td>
            <button type="button" class="btn btn-outline-danger">Delete</button>
        </td>
        <td>
            <button type="button" class="btn btn-outline-warning">Edit</button>
        </td>
        <td>
            <button type="button" class="btn btn-outline-warning">View</button>
        </td>
    </tr>
    </tbody>
</table>
<div style="text-align:center">
    <button id="loadMore" class="btn btn-outline-primary">Tải thêm</button>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
        $("#searchForm").submit(function (e) {
            e.preventDefault();
            const productName = $("#name").val();
            $.ajax({
                url: `/api/blog/blog/search/${productName}`,
                type: "GET",
                success: function (data) {
                    $("tbody").empty();
                    $.each(data, function (index, blog) {
                        const row = `
                        <tr>
                            <td>${blog.id}</td>
                            <td>${blog.title}</td>
                            <td>${blog.date}</td>
                            <td>
                                <button type="button" class="btn btn-outline-danger">Delete</button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-outline-warning">Edit</button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-outline-warning">View</button>
                            </td>
                        </tr>`;
                        $("tbody").append(row);
                    });

                    if (data.length === 0) {
                        $("#result").html("Không tìm thấy sản phẩm.");
                    } else {
                        $("#result").empty();
                    }
                },
                error: function (error) {
                    console.error("There was a problem with the AJAX request:", error);
                },
            });
        });
    });

</script>
<script>
    $(document).ready(function () {
        let displayedBlogs = 0;
        const blogsPerPage = 20;
        let totalBlogs =${totalBlogs};
        $("#loadMore").click(function () {
            const remainingBlogs = totalBlogs - displayedBlogs;
            const blogsToLoad = Math.min(blogsPerPage, remainingBlogs);
            if (blogsToLoad > 0) {
                $.ajax({
                    url: `/api/blog/loadMore/${displayedBlogs}/${blogsToLoad}`,
                    type: "GET",
                    success: function (data) {
                        $.each(data, function (index, blog) {
                            const row = `
                            <tr>
                                <td>${blog.id}</td>
                                <td>${blog.title}</td>
                                <td>${blog.date}</td>
                                <td>
                                    <button type="button" class="btn btn-outline-danger">Delete</button>
                                </td>
                                <td>
                                    <button type="button" class="btn btn-outline-warning">Edit</button>
                                </td>
                                <td>
                                    <button type="button" class="btn btn-outline-warning">View</button>
                                </td>
                            </tr>`;
                            $("tbody").append(row);
                        });
                        displayedBlogs += blogsToLoad;
                        if (displayedBlogs >= totalBlogs) {
                            $("#loadMore").hide();
                        }
                    },
                    error: function (error) {
                        console.error("There was a problem with the AJAX request:", error);
                    },
                });
            }
        });
    });

</script>


</body>
</html>
